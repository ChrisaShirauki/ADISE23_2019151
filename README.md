# ADISE24_2019151


 Το Link για το project παρακάτω:
https://github.com/ChrisaShirauki/ADISE24_2019151

Η εφαρμογή αυτή δημιουργήθηκε με βάση την εφαρμογή σκάκι που παρουσιάστηκε στο μάθημα της  Ανάπτυξης Διαδικτυακών συστημάτων και εφαρμογών. Το παιχνίδι ονομάζεται Blokus και έχει τα παρακάτω χαρακτηριστικά: 
  1) Είναι ένα επιτραπέζιο παιχνίδι στρατηγικής που σχεδιάστηκε για 2-4 παίκτες. Σκοπός του παιχνιδιού είναι να τοποθετήσεις όσο το δυνατόν περισσότερα από τα κομμάτια σου στον πίνακα
  2) Αποτελείται από ένα πλέγμα (grid) 20x20 κυψελών.Κάθε παίκτης ξεκινά από τη γωνία του πλέγματος και τοποθετεί κομμάτια σε κάθε γύρο.
  3) Κάθε παίκτης έχει 21 κομμάτια, το καθένα με διαφορετικά σχήματα που θυμίζουν Tetris (πολύγωνα). Τα κομμάτια αυτά έχουν σταθερό μέγεθος και είναι ίδια για όλους τους παίκτες των τεσσάρων χρωμάτων ( Κόκκινο, Μπλε, Κίτρινο, Πράσινο).
  4) Το πρώτο κομμάτι κάθε παίκτη πρέπει να τοποθετηθεί σε μία από τις 4 γωνίες του πίνακα 20x20. Κάθε νέο κομμάτι που προστίθεται πρέπει να ακουμπά τουλάχιστον γωνία ή κομμάτι του ίδιου χρώματος,  ενώ κομμάτια του ίδιου χρώματος δεν επιτρέπεται να ακουμπούν πλευρές. Τα κομμάτια διαφορετικών παικτών μπορούν να ακουμπούν οποιοδήποτε σημείο (πλευρές ή γωνίες). Τέλος, όταν ένας παίκτης δεν μπορεί να τοποθετήσει άλλο κομμάτι, σταματά να παίζει.
  5) Νικητής του παιχνιδιού είναι αυτός που έχει τοποθετήσει τα περισσότερα κομμάτια του.

_______________________________________________________________________________________________________________________________________________________________________________________________________________________


Υλοποίηση του Blokus σε διαδικτυακή εφαρμογή:
 
 Όσον αφορά το σχεδιασμό είναι σημαντικό να αναφερθεί πως γίνεται έλγχος κατάστασης παχινιδιού. Συγκεκριμένα υπάρχουν: 

 Α. Οι Καταστάσεις παιχνιδιού:  
	1. INACTIVE.   
	2. INITIALISED.  
	3. STARTED.   
	4. ENDED.       
	5. ABORTED

    ! Αλλάζουν ανάλογα με τις ενέργειες που γίνονται στο παιχνίδι.

Β. AFK Action 
    Κάθε παίκτης όταν έρχεται η σειρά του έχει στη διάθεση του 2 λεπτά για να τοποθετήσει ένα οποιδήποτε κομμάτι.Σε περίπτωση που κάποιος αποχωρεί ή αποσυνδέεται για κάποιο λόγο από το παιχνίδι αυτό τερματίζει αυτόματα και δηλώνει το νικητή. Αυτό υλοποιείται μέσω χρήσης timestamp last_action. Η συγκεκριμένη συνάρτηση ανανεώνεται κάθε φορά που o παίκτης:
                ~ Ξεκινάει νέο παιχνίδι
                ~ Τοποθετεί ένα κομμάτι στο πίνακα.
                ~ Εγκαταλείπει το παιχνίδι ή αποσυνδέται.
                ~ Εώς ότου κάνει pass σε περίπτωση που δεν μπορεί να τοποθετήσει block στον πίνακα.

Γ. Πίνακα με τα 21 blocks όπου γίνεται με τη χρήση ενός λεξικού (dictionary) στην PHP ώστε να αναπαρασταθεί η μορφή του σε πιθανό UI και οι δυνατές περιστροφές του. Το λεξικό αυτό ονομάζεται blocks.php. Ανάλογα με το πως θέλουμε να περιστρέψουμε ένα block έχουμε 4 δυνατές περιστρόφες με τη φορά του ρολογιού. 

!Προσοχή: Δεν έχουν όλα τα πιόνια 4 περιστροφές. Ωστόσο το πρόγραμμαα έχει σχεδιαστεί με τέτοιον τρόπο έτσι ώστε ανάλογα με το νούμερο της περιστροφής να βρίσκει τη σωστή μορφή του block.

Δ. Κάθε φορά που τελείωνει ένα παιχνίδι δεν καθαρίζουμε το πίνακα board. Υπάρχει ένα αντίγραφο που επαναφέρει την αρχική κατάσταση των blocks πριν ξεκινήσει το παιχνίδι μέσω της SQL εντολής REPLACE. Στη βάση έχει δημιουργηθεί ένας πίνακας με όλα τα 81 blocks των 4 παικτών. Κάθε φορά που ο παίκτης τοποθετεί ένα κομμάτι στον board αυτό σβήνεται από το blocks_initial. Σε περίπτωση που ο χρήστης προσπαθεί να παίξει ήδη τοποθετημένο block πετάγεται το Error 400 - Bad Request.


Ε. Επειδή το παιχνίδι παίζεται με 4 παίκτες κάθε φορά που ξεκινάει ένα νέο παιχνίδι μαζί με τους δύο αυθεντικοποιημένους χρήστες τοποθετούνται και 2 computer. Στη συγκεκριμένη εφαρμογή δεν παίζουν κανένα πίονι και απλά κάνουν pass κάθε φορά που έρχεται η σειρά τους.

_____________________________________________________________________________________________________________________________________________________________________________________________________________________

Εξήγηση Λειτουργίας Εφαργμογής : 

>> Ο χρήστης αναζητά να μπει σε ένα room. Εάν το συγκεκριμένο room είναι διαθέσιμο τότε μπαίνει μέσω ενός μοναδικού token και
περιμένει να συνδεθεί δεύτερος χρήστης. Όταν βρεθεί και συνδεθεί με το ίδιο τρόπο ο δεύτερος χρήστης τότε το παιχνίδι ξεκινάει. 

   ▬ Η κατάσταση πριν συνθεθεί ο 2 χρήστης είναι INITIALISED ένω όταν προστεθεί και ο δέυτερος παίκτης αλλάζει σε STARTED.

>> Το παιχνίδι επιλέγει τυχαία ποιος από τους χρήστες θα παίξει πρώτος όταν ξεκινήσει το παιχνίδι. Μόλις παίξει ο πρώτος παίκτης η σειρά ορίζεται ανάλογα με τις θέσεις τους στον πίνακα blocks. Π.Χ Έστω ο πίνακας blocks = [ R , G , B , Y]. Έστω ότι τυχαία ξεκινάει ο μπλε. Μόλις τελείωσει η σειρά του ξεκινάει ο κίτρινος, μέτά ο κόκκινος και τέλος ο πράσινος. Αυτό αλλάζει ανάλογα με το χρώμα που θα επιλεχτεί την πρώτη φορά. Εάν είναι ο πράσινος τότε θα είναι G, B , Y, R  κτλ.


>> Για την τοποθέτηση ενός block στον πίνακα υπάρχει συνάρτηση η οποία αντιστοιχεί το κομμάτι 
   του λεξικού πίνακα με τις αντίστοιχες γραμμές και στήλες του board. Ειδικότερα: 
  ○ Η συνάρτηση check_placement: Ελέγχει αν το κομμάτι μπορεί να τοποθετηθεί στο board μέσω κάποιων διαδικασιών. Οι γειτονικές κυψέλες του πίνακα παιχνιδιού ελέγχονται για να διαπιστωθεί αν υπάρχει μπλοκ του ίδιου χρώματος. Αν κάποια 
    κυψέλη του κομματιού καλύπτει ήδη κατειλημμένη θέση, η τοποθέτηση απορρίπτεται. Όπως και, όταν κάποια κυψέλη του κομματιού βρίσκεται εκτός των ορίων του πίνακα παιχνιδιού.     
    Αν δεν υπάρχει γειτονικό block του ίδιου χρώματος, η τοποθέτηση επιτρέπεται μόνο αν το κομμάτι καλύπτει μία από τις τέσσερις γωνίες αλλιώς η http αίτηση απορρίπτεται(403-Forbidden).Αν το κομμάτι πληροί όλους τους περιορισμούς,                                                                         
     επιστρέφεται ένας πίνακας  ($changes) με τις συντεταγμένες των κυψελών που θα καλυφθούν στον πίνακα παιχνιδιού. 
  ○ Η συνάρτηση rotateTableClockwise: Κάθε γραμμή του πίνακα γίνεται στήλη του νέου πίνακα, με την τελευταία γραμμή να γίνεται η πρώτη στήλη.Αυτή η συνάρτηση περιστρέφει έναν δισδιάστατο πίνακα δεξιόστροφα κατά 90 μοίρες.

>> Όταν τελειώσει ένα παιχνίδι τότε κατευθείαν γίνεται update του πίνακα board και όλα τα δεδομένα διαγράφονται. Δηλαδή, τα κομμάτια που διαγράφθηκαν επειδή χρηιμοποιήθηκαν ξαναεπαναφέρονται στον πίνακα block initial και τα δεδομένα του πίνακα player και board γίνονται NULL.

>> Κάθε φορά που ξεκινάει νέος γύρος καλείται η συνάρτηση check_winner. Εάν ένας παίκτης δεν έχει άλλα μπλοκ κερδίζει. Στη περίπτωση αυτή καλείται η declare_winner και αναγωνρίζει το παίκτη με το token kai to χρώμα που κερδίζει. Εάν όλοι οι παίκτες κάνουνε pass τότε κερδίζει ο παίκτης που έχει στη διάθεσή του τα λιγότερα block.

______________________________________________________________________________________________________________________________________________________


  Αιτήματα API που πρέπει να δώσει o χρήστης προκειμένου να μπορεί να παίξει blokus είναι οι εξής:

  >> Στάδιο /board: Καλεί τη show_board() η οποία είναι υπεύθυνη να ενημερώνει τον πίνακα board σε κάθε αλλαγή. Σε διαφορετική περίπτωση επιστρέφει HTTP   Error 405- Method Not Allowed.   // GET METHOD 

  >> Στάδιο /blocks: Καλεί τη συνάρτηση show_blocks() η οποία είναι υπεύθυνη για την εμφάνιση πληροφοριών σχετικά με τα blocks. Απορρίπτει άλλες μεθόδους με 405 Method Not Allowed. // GET METHOD    

  >> Στάδιο /shapes: Καλεί τη συνάρτηση show_shapes() η οποία σχετίζεται με την εμφάνιση του λεξικού PHP. Συγκεκριμένα, επιστρέφει δεδομένα σχετικά με τους τύπους των blocks (ή σχημάτων) του παιχνιδιού σε μορφή JSON. Εξάγει τα δεδομένα σε μορφή JSON, ώστε να μπορούν να χρησιμοποιηθούν από άλλες εφαρμογές (π.χ., JavaScript σε client-side). Αυτό είναι απαραίτητο διότι πρέπει τα blocks αργότερα να τοποθετηθούν με βάση τις συντεταγμένες του πίνακα board. // GET METHOD

 >>Στάδιο /game: Καλέι τη συνάρτηση handle_game() η οποία επιτρέφει καταστάσεις ανάλογα με την κατάσταση του παιχνιδιού. Συγκεκριμένα, αποτελείται από τις παρακάτω συναρτήσεις:
     ○ inspect_game: Ελέγχει αν υπάρχουν ανενεργοί παίκτες και τερματίζει το παιχνίδι αν χρειάζεται. Επιστρέφει την τρέχουσα κατάσταση του παιχνιδιού (game status) σε μορφή JSON ενώ παράλληλα είναι  χρήσιμη για monitoring της προόδου και της κατάστασης του παιχνιδιού από εξωτερικούς clients.  // GET METHOD
     ○ find_game: Ελέγχει αν ο χρήστης έχει δώσει έγκυρο όνομα χρήστη,  δηλαδή εάν έχει λάβει το token του. Έπειτα, εξετάζει την κατάσταση του τρέχοντος παιχνιδιού και αν δεν υπάρχει ενεργό παιχνίδι μπορεί να ξεκινήσει καινούριο. Ειδικότερα: 
                 ♦ Ελέγχει αν το username υπάρχει μέσα στο $input και αν δεν είναι κενό.
                 ♦ Εξετάζει εάν λείπει το όνομα χρήστη:
                 ♦ Επιστρέφει HTTP status code 400 Bad Request.
                 ♦ Επιστρέφει ένα JSON μήνυμα σφάλματος: {'errormesg': 'No Username given.'} σε περίπτωση που δεν δωθεί username.
                 ♦ Διακόπτει την εκτέλεση της συνάρτησης με exit.  //POST METHOD
     ○ leave_game: Επιτρέπει την ασφαλή αποχώρηση παικτών. Ο έλεγχος του token προστατεύει από μη εξουσιοδοτημένες ενέργειες και διασφαλίζει ότι μόνο οι παίκτες με έγκυρα διαπιστευτήρια μπορούν να κάνουν αλλαγές στο παιχνίδι. Μόλις αποχωρήσει κάποιος ή τελειώσει το παιχνίδι όλα διαγγράφονται και ξεκινάνε από την αρχή. // DELETE METHOD

   >>Στάδιο /place: Καλέι τη συνάρτηση handle_placement() η οποία σχετίζεται με την τοποθέτηση των blocks στο παιχνίδι. Συγκεκριμένα:
       ○ inspect_placement: Η συνάρτηση inspect_placement χρησιμοποιείται για να ελέγξει αν μια ενέργεια τοποθέτησης ενός μπλοκ (block placement) στο παιχνίδι είναι έγκυρη ή όχι.  //GET METHOD
       Επιστρέφει ένα μήνυμα σε μορφή JSON με το αποτέλεσμα της επικύρωσης. Η validate_placement μπορεί να ελέγχει παράγοντες όπως:
                             ♦ Αν το μπλοκ τοποθετείται εντός του πίνακα.
                             ♦ Αν το μπλοκ συγκρούεται με άλλα μπλοκ.
                             ♦ Αν το μπλοκ συνδέεται σωστά με μπλοκ του ίδιου χρώματος.  

                        • HTTP Status Codes:

                         200 OK: Για έγκυρες τοποθετήσεις.
                         400 Bad Request: Για άκυρες τοποθετήσεις.

       ○ place_pice: Η συνάρτηση place_piece χειρίζεται την τοποθέτηση ενός κομματιού (piece) στο παιχνίδι. Είναι υπεύθυνη για:   //PUT METHOD
                              ♦ Την επικύρωση της κίνησης.
                              ♦ Την ενημέρωση του πίνακα παιχνιδιού (board) και των διαθέσιμων κομματιών του παίκτη. 
                              ♦Την αλλαγή σειράς του παίκτη και τον έλεγχο για πιθανό νικητή.

             ~ Χρησιμοποιείται η συνάρτηση check_token για να επαληθευτεί αν το token του παίκτη είναι έγκυρο.
               Αν όχι, επιστρέφεται σφάλμα 401 Unauthorized.
             ~ Αν δεν είναι η σειρά του παίκτη (turn ≠ color), επιστρέφεται σφάλμα 403 Forbidden.

       ○ pas_turn: Η συνάρτηση pass_turn έχει ως στόχο να επιτρέψει σε έναν παίκτη να παραλείψει τη σειρά του σε ένα παιχνίδι. Η συνάρτηση ελέγχει την κατάσταση του παιχνιδιού, 
                    επικυρώνει την ταυτότητα του παίκτη, εξασφαλίζει ότι είναι η σειρά του παίκτη να παίξει, και στη συνέχεια διαχειρίζεται τη διαδικασία της παράλειψης της σειράς του.   // POST METHOD

 
>>ΠΡΟΣΟΧΗ: Σε οποιαδήποτε άλλη περίπτωση που ο χρήστης δώσει μη έγκυρη αίτηση εμφανίζεται HTTP 404 -NOT FOUND.